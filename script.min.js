const PLAYER_NAME="Logicos Video Player",PLAYER_VERSION="1.0",MODAL_FOCUSABLE_SELECTOR="button, [href], input, select, textarea, [tabindex]:not([tabindex='-1'])",sourceMetaCache=new Map,pendingSourceMeta=new Map,leadingZeroFormatter=new Intl.NumberFormat(0[0],{minimumIntegerDigits:2});class VideoPlayer{constructor(e){this.container=e,this.video=e.querySelector("video"),this.controls={playPauseBtn:e.querySelector(".play-pause-btn"),theaterBtn:e.querySelector(".theater-btn"),fullScreenBtn:e.querySelector(".full-screen-btn"),miniPlayerBtn:e.querySelector(".mini-player-btn"),muteBtn:e.querySelector(".mute-btn"),captionsBtn:e.querySelector(".captions-btn"),speedBtn:e.querySelector(".speed-btn"),currentTimeElem:e.querySelector(".current-time"),totalTimeElem:e.querySelector(".total-time"),previewImg:e.querySelector(".preview-img"),thumbnailImg:e.querySelector(".thumbnail-img"),volumeSlider:e.querySelector(".volume-slider"),timelineContainer:e.querySelector(".timeline-container")},this.isScrubbing=!1,this.wasPaused=!1,this.isContextMenuOpen=!1,this.isAboutModalOpen=!1,this.lastFocusBeforeModal=null,this.techStatusMessage="",this.techStatusIsError=!1,this.captions=this.video.textTracks[0],this.contextMenu=this.createContextMenu(),this.contextMenuItems=Array.from(this.contextMenu.querySelectorAll("[data-action]"));const t=this.createAboutModal();this.aboutOverlay=t.overlay,this.aboutDialog=t.dialog,this.aboutCloseButton=t.closeButton,this.aboutMetaList=t.metaList,this.aboutDescription=t.description,this.aboutTechToggle=t.techToggle,this.aboutTechPanel=t.techPanel,this.aboutTechStatus=t.techStatus,this.initializePlayer()}initializePlayer(){this.captions&&(this.captions.mode="hidden"),this.bindKeyboardEvents(),this.bindTimelineEvents(),this.bindControlEvents(),this.bindVideoEvents(),this.bindContextMenuEvents(),this.bindModalEvents()}bindKeyboardEvents(){this.container.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();if(t==="input")return;switch(e.key.toLowerCase()){case" ":if(t==="button")return;case"k":this.togglePlay();break;case"f":this.toggleFullScreenMode();break;case"t":this.toggleTheaterMode();break;case"i":this.toggleMiniPlayerMode();break;case"m":this.toggleMute();break;case"arrowleft":case"j":this.skip(-5);break;case"arrowright":case"l":this.skip(5);break;case"c":this.toggleCaptions();break}})}bindTimelineEvents(){const e=this.controls.timelineContainer;e.addEventListener("mousemove",e=>this.handleTimelineUpdate(e)),e.addEventListener("mousedown",e=>this.toggleScrubbing(e)),document.addEventListener("mouseup",e=>{this.isScrubbing&&this.toggleScrubbing(e)}),document.addEventListener("mousemove",e=>{this.isScrubbing&&this.handleTimelineUpdate(e)})}bindControlEvents(){const e=this.controls;e.playPauseBtn.addEventListener("click",()=>this.togglePlay()),e.speedBtn.addEventListener("click",()=>this.changePlaybackSpeed()),e.captionsBtn.addEventListener("click",()=>this.toggleCaptions()),e.muteBtn.addEventListener("click",()=>this.toggleMute()),e.theaterBtn.addEventListener("click",()=>this.toggleTheaterMode()),e.fullScreenBtn.addEventListener("click",()=>this.toggleFullScreenMode()),e.miniPlayerBtn.addEventListener("click",()=>this.toggleMiniPlayerMode()),e.volumeSlider.addEventListener("input",e=>{this.video.volume=e.target.value,this.video.muted=e.target.value===0})}bindVideoEvents(){this.video.addEventListener("loadeddata",()=>{Number.isFinite(this.video.duration)&&(this.controls.totalTimeElem.textContent=this.formatDuration(this.video.duration))}),this.video.addEventListener("timeupdate",()=>{this.controls.currentTimeElem.textContent=this.formatDuration(this.video.currentTime);const e=this.video.currentTime/this.video.duration;this.controls.timelineContainer.style.setProperty("--progress-position",e),this.isAboutModalOpen&&this.updateAboutModalContent()}),this.video.addEventListener("volumechange",()=>{this.controls.volumeSlider.value=this.video.volume;let e;this.video.muted||this.video.volume===0?(this.controls.volumeSlider.value=0,e="muted"):this.video.volume>=.5?e="high":e="low",this.container.dataset.volumeLevel=e,this.isAboutModalOpen&&this.updateAboutModalContent()}),this.video.addEventListener("play",()=>{this.container.classList.remove("paused")}),this.video.addEventListener("pause",()=>{this.container.classList.add("paused")}),this.video.addEventListener("click",()=>this.togglePlay()),this.video.addEventListener("enterpictureinpicture",()=>{this.container.classList.add("mini-player"),this.isAboutModalOpen&&this.updateAboutModalContent()}),this.video.addEventListener("leavepictureinpicture",()=>{this.container.classList.remove("mini-player"),this.isAboutModalOpen&&this.updateAboutModalContent()}),this.video.addEventListener("loadedmetadata",()=>{this.isAboutModalOpen&&(this.updateAboutModalContent(),this.ensureTechMetadata({showStatus:this.isTechPanelExpanded()}))})}bindContextMenuEvents(){this.container.addEventListener("contextmenu",e=>this.showContextMenu(e)),this.contextMenu.addEventListener("click",e=>this.handleContextMenuClick(e)),this.contextMenu.addEventListener("keydown",()=>this.handleContextMenuKeyboard());const e=["pointermove","pointerdown","wheel"];e.forEach(e=>{this.contextMenu.addEventListener(e,()=>{if(this.contextMenu.dataset.inputMethod!=="pointer"){const e=document.activeElement;e&&this.contextMenu.contains(e)&&e.blur()}this.contextMenu.dataset.inputMethod="pointer"},{passive:!0})}),document.addEventListener("click",e=>this.handleDocumentClick(e)),document.addEventListener("keydown",e=>this.handleGlobalKeydown(e)),window.addEventListener("resize",()=>this.hideContextMenu()),document.addEventListener("scroll",()=>this.hideContextMenu(),!0)}bindModalEvents(){this.aboutCloseButton.addEventListener("click",()=>this.closeAboutModal()),this.aboutOverlay.addEventListener("click",e=>this.handleOverlayClick(e)),document.addEventListener("focusin",e=>this.keepFocusInsideModal(e)),this.aboutTechToggle&&this.aboutTechToggle.addEventListener("click",()=>this.toggleTechPanel()),document.addEventListener("fullscreenchange",()=>{const e=Boolean(document.fullscreenElement===this.container);this.container.classList.toggle("full-screen",e),this.isAboutModalOpen&&this.updateAboutModalContent()})}toggleScrubbing(e){const t=this.controls.timelineContainer.getBoundingClientRect(),n=Math.min(Math.max(0,e.x-t.x),t.width)/t.width;this.isScrubbing=(e.buttons&1)===1,this.container.classList.toggle("scrubbing",this.isScrubbing),this.isScrubbing?(this.wasPaused=this.video.paused,this.video.pause()):(this.video.currentTime=n*this.video.duration,this.wasPaused||this.video.play()),this.handleTimelineUpdate(e)}handleTimelineUpdate(e){const t=this.controls.timelineContainer.getBoundingClientRect(),n=Math.min(Math.max(0,e.x-t.x),t.width)/t.width,o=Math.max(1,Math.floor(n*this.video.duration/10)),s=`assets/preview/masterclass_de_kracht_vh_ouderschapsplan-20240321_preview${o}.jpg`;this.controls.previewImg.src=s,this.controls.timelineContainer.style.setProperty("--preview-position",n),this.isScrubbing&&(e.preventDefault(),this.controls.thumbnailImg.src=s,this.controls.timelineContainer.style.setProperty("--progress-position",n))}togglePlay(){this.video.paused?this.video.play():this.video.pause()}skip(e){this.video.currentTime+=e}changePlaybackSpeed(){let e=this.video.playbackRate+.25;e>2&&(e=.25),this.video.playbackRate=e,this.controls.speedBtn.textContent=`${e}×`,this.isAboutModalOpen&&this.updateAboutModalContent()}toggleCaptions(){if(!this.captions)return;const e=this.captions.mode==="hidden";this.captions.mode=e?"showing":"hidden",this.container.classList.toggle("captions",e),this.isAboutModalOpen&&this.updateAboutModalContent()}toggleMute(){this.video.muted=!this.video.muted}toggleTheaterMode(){this.container.classList.toggle("theater"),this.isAboutModalOpen&&this.updateAboutModalContent()}toggleFullScreenMode(){document.fullscreenElement===this.container?document.exitFullscreen():this.container.requestFullscreen()}toggleMiniPlayerMode(){this.container.classList.contains("mini-player")?document.exitPictureInPicture():this.video.requestPictureInPicture()}createMenuItem(e,t,n){const s=document.createElement("button");s.type="button",s.className="context-menu-item",s.dataset.action=n;const o=document.createElement("span");o.className="menu-label",o.textContent=e;const i=document.createElement("span");return i.className="menu-shortcut",i.textContent=t,s.append(o,i),s}createContextMenu(){const e=document.createElement("div");e.className="video-context-menu",e.setAttribute("role","menu"),e.setAttribute("aria-hidden","true"),e.dataset.inputMethod="keyboard";const t=[["Play","K","togglePlay"],["Mute","M","toggleMute"],["Playback Speed 1×","Shift + >","changeSpeed"],["Turn On Captions","C","toggleCaptions"],"hr",["Enter Theater Mode","T","toggleTheater"],["Enter Full Screen","F","toggleFullScreen"],["Enter Picture-in-Picture","I","toggleMiniPlayer"],"hr",[`About ${PLAYER_NAME}`,"—","showAbout"]];for(const n of t)if(n==="hr")e.appendChild(document.createElement("hr"));else{const[t,s,o]=n;e.appendChild(this.createMenuItem(t,s,o))}return e.style.display="none",e._playerInstance=this,document.body.appendChild(e),e}showContextMenu(e){e.preventDefault(),document.querySelectorAll(".video-context-menu.is-open").forEach(e=>{e!==this.contextMenu&&(e.classList.remove("is-open"),e.style.display="none",e.setAttribute("aria-hidden","true"))});const i=e.button===0;if(this.contextMenu.dataset.inputMethod=i?"keyboard":"pointer",!i){const e=document.activeElement;e&&this.contextMenu.contains(e)&&e.blur()}this.updateContextMenuLabels(),this.contextMenu.style.display="block",this.contextMenu.classList.add("is-open"),this.contextMenu.setAttribute("aria-hidden","false"),this.contextMenu.style.left="0px",this.contextMenu.style.top="0px";const o=this.contextMenu.getBoundingClientRect();let n=e.clientX,s=e.clientY;const t=8;if(n+o.width>window.innerWidth-t&&(n=window.innerWidth-o.width-t),s+o.height>window.innerHeight-t&&(s=window.innerHeight-o.height-t),n=Math.max(t,n),s=Math.max(t,s),this.contextMenu.style.left=`${n}px`,this.contextMenu.style.top=`${s}px`,this.isContextMenuOpen=!0,i){const e=this.contextMenuItems.find(e=>!e.disabled);e?.focus({preventScroll:!0})}}hideContextMenu(){if(!this.isContextMenuOpen)return;this.isContextMenuOpen=!1;const e=document.activeElement;e&&this.contextMenu.contains(e)&&e.blur(),this.contextMenu.classList.remove("is-open"),this.contextMenu.style.display="none",this.contextMenu.setAttribute("aria-hidden","true")}handleContextMenuClick(e){const t=e.target.closest("[data-action]");if(!t||t.disabled)return;const s=t.dataset.action,o={togglePlay:()=>this.togglePlay(),toggleMute:()=>this.toggleMute(),changeSpeed:()=>this.changePlaybackSpeed(),toggleCaptions:()=>this.toggleCaptions(),toggleTheater:()=>this.toggleTheaterMode(),toggleFullScreen:()=>this.toggleFullScreenMode(),toggleMiniPlayer:()=>this.toggleMiniPlayerMode(),showAbout:()=>this.openAboutModal()},n=o[s];n&&n(),this.hideContextMenu()}handleDocumentClick(e){if(!this.isContextMenuOpen)return;if(this.contextMenu.contains(e.target))return;if(this.container.contains(e.target))return;this.hideContextMenu()}handleContextMenuKeyboard(){this.contextMenu.dataset.inputMethod="keyboard";const e=document.activeElement;if(!this.contextMenu.contains(e)){const e=this.contextMenuItems.find(e=>!e.disabled);e?.focus({preventScroll:!0})}}handleGlobalKeydown(e){if(this.isAboutModalOpen&&this.aboutDialog.contains(document.activeElement)){if(e.key==="Escape"){e.preventDefault(),this.closeAboutModal();return}e.key==="Tab"&&this.trapFocusInAboutModal(e);return}if(!this.isContextMenuOpen)return;if(!this.contextMenu.contains(document.activeElement))return;e.key==="Escape"&&(e.preventDefault(),this.hideContextMenu(),this.video.focus({preventScroll:!0}))}updateContextMenuLabels(){const e=e=>Number.isInteger(e)?`${e.toFixed(0)}×`:`${e.toFixed(2).replace(/\.0+$/,"").replace(/(\.[1-9])0$/,"$1")}×`;this.contextMenuItems.forEach(t=>{const n=t.querySelector(".menu-label");if(!n)return;switch(t.dataset.action){case"togglePlay":n.textContent=this.video.paused?"Play":"Pause";break;case"toggleMute":n.textContent=this.video.muted||this.video.volume===0?"Unmute":"Mute";break;case"changeSpeed":n.textContent=`Playback Speed ${e(this.video.playbackRate)}`;break;case"toggleCaptions":if(this.captions){t.disabled=!1;const e=this.captions.mode==="showing";n.textContent=e?"Turn Off Captions":"Turn On Captions"}else t.disabled=!0,n.textContent="Captions Unavailable";break;case"toggleTheater":n.textContent=this.container.classList.contains("theater")?"Exit Theater Mode":"Enter Theater Mode";break;case"toggleFullScreen":n.textContent=document.fullscreenElement===this.container?"Exit Full Screen":"Enter Full Screen";break;case"toggleMiniPlayer":{const e="pictureInPictureEnabled"in document;if(e){t.disabled=!1;const e=document.pictureInPictureElement===this.video;n.textContent=e?"Exit Picture-in-Picture":"Enter Picture-in-Picture"}else t.disabled=!0,n.textContent="Picture-in-Picture Unavailable";break}case"showAbout":t.disabled=!1,n.textContent=`About ${PLAYER_NAME}`;break;default:break}})}createAboutModal(){const o=document.createElement("div");o.className="modal-overlay";const e=document.createElement("div");e.className="about-modal",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","about-modal-title"),e.setAttribute("aria-hidden","true"),e.tabIndex=-1;const n=document.createElement("button");n.type="button",n.className="about-close-btn",n.setAttribute("aria-label","Close dialog"),n.innerHTML="&times;",e.appendChild(n);const f=document.createElement("div");f.className="about-modal-header";const c=document.createElement("div");c.className="about-modal-title-block";const m=document.createElement("p");m.className="about-modal-eyebrow",m.textContent=PLAYER_NAME;const h=document.createElement("h2");h.id="about-modal-title",h.textContent="About",c.append(m,h);const r=document.createElement("span");r.className="about-modal-version",r.setAttribute("aria-label",`Version ${PLAYER_VERSION}`),r.textContent=`v${PLAYER_VERSION}`,f.append(c,r),e.appendChild(f);const d=document.createElement("p");d.className="about-modal-description",e.appendChild(d);const l=document.createElement("div");l.className="about-tech";const t=document.createElement("button");t.type="button",t.className="tech-toggle",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","about-tech-panel");const u=document.createElement("span");u.className="tech-toggle-label",u.textContent="Technical Details";const a=document.createElement("span");a.className="tech-toggle-icon",a.setAttribute("aria-hidden","true"),a.textContent="▾",t.append(u,a);const s=document.createElement("div");s.className="tech-panel",s.id="about-tech-panel",s.hidden=!0;const i=document.createElement("div");i.className="tech-status",i.hidden=!0;const p=document.createElement("dl");return p.className="about-meta-list",s.append(i,p),l.append(t,s),e.appendChild(l),o.appendChild(e),o._playerInstance=this,document.body.appendChild(o),{overlay:o,dialog:e,closeButton:n,metaList:p,description:d,techToggle:t,techPanel:s,techStatus:i}}openAboutModal(){if(this.isAboutModalOpen)return;document.querySelectorAll(".modal-overlay.is-open").forEach(e=>{e!==this.aboutOverlay&&e._playerInstance&&e._playerInstance.closeAboutModal()}),this.lastFocusBeforeModal=document.activeElement;const e=this.video.getAttribute("data-video-title")||document.title,t=e?`"${e}"`:"this session";this.aboutDescription.textContent=`You are watching ${t} using ${PLAYER_NAME} v${PLAYER_VERSION}, our custom HTML5 experience featuring keyboard shortcuts, theater view, picture-in-picture, and fine-grained controls.`,this.setTechPanelExpanded(!1),this.updateAboutModalContent(),this.aboutOverlay.classList.add("is-open"),document.body.classList.add("modal-open"),this.isAboutModalOpen=!0,this.ensureTechMetadata({showStatus:!1}),requestAnimationFrame(()=>{this.aboutDialog.removeAttribute("aria-hidden"),this.aboutCloseButton.focus({preventScroll:!0})})}closeAboutModal(){if(!this.isAboutModalOpen)return;this.isAboutModalOpen=!1,this.aboutOverlay.classList.remove("is-open"),this.aboutDialog.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open"),this.setTechPanelExpanded(!1),this.setTechStatus("",!1);const e=this.lastFocusBeforeModal&&typeof this.lastFocusBeforeModal.focus=="function"?this.lastFocusBeforeModal:this.video;this.lastFocusBeforeModal=null,requestAnimationFrame(()=>{e.focus({preventScroll:!0})})}handleOverlayClick(e){e.target===this.aboutOverlay&&this.closeAboutModal()}keepFocusInsideModal(e){if(!this.isAboutModalOpen)return;this.aboutDialog.contains(e.target)||this.aboutOverlay.contains(e.target)&&this.aboutCloseButton.focus({preventScroll:!0})}trapFocusInAboutModal(e){const t=Array.from(this.aboutDialog.querySelectorAll(MODAL_FOCUSABLE_SELECTOR)).filter(e=>!e.hasAttribute("disabled")&&e.tabIndex!==-1);if(t.length===0){e.preventDefault(),this.aboutCloseButton.focus({preventScroll:!0});return}const n=t[0],s=t[t.length-1];!e.shiftKey&&document.activeElement===s?(e.preventDefault(),n.focus({preventScroll:!0})):e.shiftKey&&document.activeElement===n&&(e.preventDefault(),s.focus({preventScroll:!0}))}toggleTechPanel(){this.setTechPanelExpanded(!this.isTechPanelExpanded())}setTechPanelExpanded(e){if(!this.aboutTechToggle||!this.aboutTechPanel)return;this.aboutTechToggle.setAttribute("aria-expanded",String(e)),this.aboutTechToggle.classList.toggle("is-expanded",e),this.aboutTechPanel.hidden=!e,e&&this.ensureTechMetadata({showStatus:!0}),this.updateTechStatusVisibility()}isTechPanelExpanded(){return this.aboutTechToggle?.getAttribute("aria-expanded")==="true"}async ensureTechMetadata({showStatus:e=!0}={}){const t=this.getResolvedVideoSrc();if(!t)return;const n=sourceMetaCache.get(t);if(n&&!n.error)return;if(pendingSourceMeta.has(t)){e&&this.isTechPanelExpanded()&&this.setTechStatus("Fetching video metadata…",!1);return}e&&this.isTechPanelExpanded()&&this.setTechStatus("Fetching video metadata…",!1);try{const e=await this.ensureVideoSourceMeta(t);e?.error?this.setTechStatus("Unable to retrieve video metadata.",!0):this.setTechStatus("",!1)}catch{this.setTechStatus("Unable to retrieve video metadata.",!0)}finally{this.updateAboutModalContent()}}setTechStatus(e,t=!1){this.techStatusMessage=e,this.techStatusIsError=t,this.updateTechStatusVisibility()}updateTechStatusVisibility(){if(!this.aboutTechStatus)return;const e=Boolean(this.techStatusMessage)&&this.isTechPanelExpanded();this.aboutTechStatus.textContent=this.techStatusMessage,this.aboutTechStatus.hidden=!e,this.aboutTechStatus.classList.toggle("is-error",this.techStatusIsError)}updateAboutModalContent(){if(!this.aboutMetaList)return;const t=this.getResolvedVideoSrc(),o=this.video.currentSrc||this.video.src,p=this.deriveVideoSourceLabel(o),f=this.formatVideoDuration(this.video.duration),a=this.formatVideoDuration(this.video.currentTime),d=this.video.videoWidth&&this.video.videoHeight?`${this.video.videoWidth} × ${this.video.videoHeight}`:"Pending",c=this.formatPlaybackRate(this.video.playbackRate),r=`${Math.round(this.video.volume*100)}%${this.video.muted?" (Muted)":""}`;let s="Unavailable";if(this.captions){const e=this.captions.label||this.captions.language||"Track 1";s=this.captions.mode==="showing"?e?`On (${e})`:"On":e?`Off (${e})`:"Off"}const l=this.getPlaybackModeLabel(),e=t?sourceMetaCache.get(t):0[0],u=(()=>e?e.error?"Unavailable":Number.isFinite(e.fileSize)?this.formatFileSize(e.fileSize):"Unknown":pendingSourceMeta.has(t)?"Fetching…":"Unknown")(),h=(()=>{if(!e)return pendingSourceMeta.has(t)?"Calculating…":"Unknown";if(e.error)return"Unavailable";if(Number.isFinite(e.fileSize)&&this.video.duration>0){const t=e.fileSize*8/this.video.duration;return this.formatBitrate(t)}return"Unknown"})(),m=e?.contentType||this.deriveMimeFromSrc(o)||"Unknown";let n="",i=!1;pendingSourceMeta.has(t)?n="Fetching video metadata…":e?.error&&(n="Unable to retrieve video metadata.",i=!0),this.setTechStatus(n,i);const g=[{label:"Video Source",value:p},{label:"MIME Type",value:m},{label:"File Size",value:u},{label:"Average Bitrate",value:h},{label:"Duration",value:f},{label:"Current Position",value:a},{label:"Resolution",value:d},{label:"Playback Speed",value:c},{label:"Volume",value:r},{label:"Captions",value:s},{label:"Playback Mode",value:l}];this.aboutMetaList.textContent="",g.forEach(({label:e,value:t})=>{const n=document.createElement("dt");n.className="about-meta-term",n.textContent=e;const s=document.createElement("dd");s.className="about-meta-value",s.textContent=t,this.aboutMetaList.append(n,s)})}getResolvedVideoSrc(){const e=this.video.currentSrc||this.video.src;if(!e)return"";try{return new URL(e,window.location.href).href}catch{return e}}async ensureVideoSourceMeta(e){if(sourceMetaCache.has(e)){const t=sourceMetaCache.get(e);if(!t||t.error)sourceMetaCache.delete(e);else return t}if(pendingSourceMeta.has(e))return pendingSourceMeta.get(e);const t=(async()=>{try{const t=await fetch(e,{method:"HEAD"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=t.headers.get("content-length"),s=n?Number(n):NaN,i=Number.isFinite(s)?s:null,a=t.headers.get("content-type")||"",o={fileSize:i,contentType:a};return sourceMetaCache.set(e,o),o}catch(t){const n={error:t instanceof Error?t.message:"Metadata request failed"};return sourceMetaCache.set(e,n),n}finally{pendingSourceMeta.delete(e)}})();return pendingSourceMeta.set(e,t),t}formatDuration(e){if(!Number.isFinite(e)||e<0)return"0:00";const t=Math.floor(e%60),n=Math.floor(e/60)%60,s=Math.floor(e/3600);return s===0?`${n}:${leadingZeroFormatter.format(t)}`:`${s}:${leadingZeroFormatter.format(n)}:${leadingZeroFormatter.format(t)}`}formatVideoDuration(e){return!Number.isFinite(e)||e<0?"Loading...":this.formatDuration(e)}deriveMimeFromSrc(e){if(!e)return"";const s=e.split("?")[0].split("#")[0],t=s.split(".");if(t.length<2)return"";const n=t.pop().toLowerCase(),o={mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",m3u8:"application/x-mpegURL"};return o[n]||`video/${n}`}deriveVideoSourceLabel(e){if(!e)return"Unavailable";try{const n=new URL(e,window.location.href),t=n.pathname.split("/").filter(Boolean);return t.length?decodeURIComponent(t[t.length-1]):n.hostname}catch{const t=e.split("/");return decodeURIComponent(t[t.length-1]||e)}}formatFileSize(e){if(!Number.isFinite(e)||e<=0)return"Unknown";const s=["B","KB","MB","GB","TB"];let t=e,n=0;for(;t>=1024&&n<s.length-1;)t/=1024,n+=1;const o=t<10&&n>0?2:1;return`${parseFloat(t.toFixed(o))} ${s[n]}`}formatBitrate(e){if(!Number.isFinite(e)||e<=0)return"Unknown";const s=["bps","Kbps","Mbps","Gbps"];let t=e,n=0;for(;t>=1e3&&n<s.length-1;)t/=1e3,n+=1;const o=t<10&&n>0?2:1;return`${parseFloat(t.toFixed(o))} ${s[n]}`}getPlaybackModeLabel(){return document.pictureInPictureElement===this.video?"Picture-in-Picture":document.fullscreenElement===this.container?"Full Screen":this.container.classList.contains("theater")?"Theater":"Standard"}formatPlaybackRate(e){if(!Number.isFinite(e))return"1×";const t=e%1===0?e.toFixed(0):e.toFixed(2).replace(/0+$/,"").replace(/\.$/,"");return`${t}×`}destroy(){this.contextMenu&&this.contextMenu.parentNode&&this.contextMenu.parentNode.removeChild(this.contextMenu),this.aboutOverlay&&this.aboutOverlay.parentNode&&this.aboutOverlay.parentNode.removeChild(this.aboutOverlay)}}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".video-container");e.forEach(e=>{new VideoPlayer(e)})})